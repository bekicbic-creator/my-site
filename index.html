<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pixel Run Love</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      background: #87CEEB;
      font-family: monospace;
    }
    canvas {
      display: block;
      background: linear-gradient(#ff9966, #ff5e62);
      width: 100vw;
      height: 100vh;
    }
    #msg {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.5);
      color: #fff;
      padding: 8px 12px;
      border-radius: 10px;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div id="msg">–ù–∞–∂–º–∏ [–ü—Ä–æ–±–µ–ª] –∏–ª–∏ [–¢–∞–ø], —á—Ç–æ–±—ã –ø—Ä—ã–≥–Ω—É—Ç—å üçî</div>
  <canvas id="game"></canvas>
  <audio id="music" loop>
    <source src="https://cdn.pixabay.com/audio/2023/01/10/audio_97c5beea75.mp3" type="audio/mpeg">
  </audio>
  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const music = document.getElementById("music");
    music.volume = 0.3;
    music.play().catch(()=>{});

    // === –ò–≥—Ä–æ–≤—ã–µ —Ä–µ—Å—É—Ä—Å—ã ===
    const playerImg = new Image();
    playerImg.src = "https://i.ibb.co/4mxR2wC/player.png"; // –ø–∏–∫—Å–µ–ª—å–Ω—ã–π –ø–∞—Ä–µ–Ω—å
    const girlImg = new Image();
    girlImg.src = "https://i.ibb.co/ZTkgfXy/girl.png"; // –ø–∏–∫—Å–µ–ª—å–Ω–∞—è –¥–µ–≤—É—à–∫–∞
    const cactusImg = new Image();
    cactusImg.src = "https://i.ibb.co/YfF25QF/cactus.png";
    const burgerImg = new Image();
    burgerImg.src = "https://i.ibb.co/JvgbxwH/burger.png";
    const heartImg = new Image();
    heartImg.src = "https://i.ibb.co/3d5tmCX/heart.png";
    const houseImg = new Image();
    houseImg.src = "https://i.ibb.co/QYdKdZN/house.png";

    let player = { x: 100, y: 0, w: 80, h: 80, vy: 0, jumping: false, invincible: false };
    let ground = canvas.height - 150;
    let obstacles = [];
    let burgers = [];
    let gameSpeed = 8;
    let score = 0;
    let level = 1;
    let girlMet = false;
    let invincibleTimer = 0;

    function spawnObstacle() {
      obstacles.push({ x: canvas.width, y: ground - 60, w: 50, h: 60 });
    }

    function spawnBurger() {
      burgers.push({ x: canvas.width, y: ground - 100, w: 50, h: 40 });
    }

    function jump() {
      if (!player.jumping) {
        player.vy = -25;
        player.jumping = true;
      }
    }

    document.addEventListener("keydown", e => { if (e.code === "Space") jump(); });
    document.addEventListener("touchstart", jump);

    let frame = 0;

    function update() {
      frame++;
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // —Ñ–æ–Ω —Å –¥–æ–º–æ–º
      ctx.drawImage(houseImg, 0, ground - 250, 400, 250);

      // –∑–µ–º–ª—è
      ctx.fillStyle = "#228B22";
      ctx.fillRect(0, ground, canvas.width, 200);

      // —Ñ–∏–∑–∏–∫–∞
      player.y += player.vy;
      player.vy += 1.5;
      if (player.y > ground - player.h) {
        player.y = ground - player.h;
        player.jumping = false;
      }

      // —Å–ø–∞–≤–Ω –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –∏ –±—É—Ä–≥–µ—Ä–æ–≤
      if (frame % 90 === 0) spawnObstacle();
      if (frame % 600 === 0) spawnBurger();

      // –¥–≤–∏–∂–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
      for (let i = obstacles.length - 1; i >= 0; i--) {
        let o = obstacles[i];
        o.x -= gameSpeed;
        ctx.drawImage(cactusImg, o.x, o.y, o.w, o.h);

        if (!player.invincible &&
            player.x < o.x + o.w && player.x + player.w > o.x &&
            player.y + player.h > o.y) {
          location.reload();
        }

        if (o.x + o.w < 0) obstacles.splice(i, 1);
      }

      // –¥–≤–∏–∂–µ–Ω–∏–µ –±—É—Ä–≥–µ—Ä–æ–≤
      for (let i = burgers.length - 1; i >= 0; i--) {
        let b = burgers[i];
        b.x -= gameSpeed;
        ctx.drawImage(burgerImg, b.x, b.y, b.w, b.h);
        if (player.x < b.x + b.w && player.x + player.w > b.x && player.y + player.h > b.y) {
          player.invincible = true;
          invincibleTimer = 900;
          burgers.splice(i, 1);
        }
        if (b.x + b.w < 0) burgers.splice(i, 1);
      }

      // –∏–Ω–≤—É–ª
      if (player.invincible) {
        invincibleTimer--;
        if (invincibleTimer <= 0) player.invincible = false;
        ctx.globalAlpha = 0.6 + 0.4 * Math.sin(frame / 5);
      } else {
        ctx.globalAlpha = 1;
      }

      // —Ä–∏—Å—É–µ–º –∏–≥—Ä–æ–∫–∞
      ctx.drawImage(playerImg, player.x, player.y, player.w, player.h);
      ctx.globalAlpha = 1;

      // —Å—á—ë—Ç –∏ —É—Ä–æ–≤–Ω–∏
      score++;
      if (score % 2000 === 0) {
        level++;
        gameSpeed += 1.5;
      }

      ctx.fillStyle = "#fff";
      ctx.font = "30px monospace";
      ctx.fillText("–°—á—ë—Ç: " + score, 30, 50);
      ctx.fillText("–£—Ä–æ–≤–µ–Ω—å: " + level, 30, 90);

      // –∫–æ–Ω–µ—Ü –∏–≥—Ä—ã ‚Äî –≤—Å—Ç—Ä–µ—á–∞ —Å –¥–µ–≤—É—à–∫–æ–π
      if (score > 5000 && !girlMet) {
        girlMet = true;
        setTimeout(() => {
          meetGirl();
        }, 500);
      }

      requestAnimationFrame(update);
    }

    function meetGirl() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(houseImg, 0, ground - 250, 400, 250);
      ctx.fillStyle = "#228B22";
      ctx.fillRect(0, ground, canvas.width, 200);
      ctx.drawImage(playerImg, canvas.width / 2 - 150, ground - 80, 80, 80);
      ctx.drawImage(girlImg, canvas.width / 2 + 50, ground - 80, 80, 80);

      let hearts = [];
      for (let i = 0; i < 20; i++) {
        hearts.push({ x: canvas.width / 2 + Math.random() * 100 - 50, y: ground - 150, vy: -Math.random() * 3 - 2 });
      }

      let anim = setInterval(() => {
        ctx.drawImage(houseImg, 0, ground - 250, 400, 250);
        ctx.fillStyle = "#228B22";
        ctx.fillRect(0, ground, canvas.width, 200);
        ctx.drawImage(playerImg, canvas.width / 2 - 150, ground - 80, 80, 80);
        ctx.drawImage(girlImg, canvas.width / 2 + 50, ground - 80, 80, 80);
        hearts.forEach(h => {
          ctx.drawImage(heartImg, h.x, h.y, 30, 30);
          h.y += h.vy;
        });
      }, 50);

      setTimeout(() => {
        clearInterval(anim);
        ctx.fillStyle = "#fff";
        ctx.font = "40px monospace";
        ctx.fillText("‚ù§Ô∏è –û–Ω–∏ —Å–Ω–æ–≤–∞ –≤–º–µ—Å—Ç–µ ‚ù§Ô∏è", canvas.width / 2 - 200, canvas.height / 2);
      }, 5000);
    }

    update();
  </script>
</body>
</html>
